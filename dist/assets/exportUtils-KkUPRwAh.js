import{c as r,d as i,q as h,o as y,g as c}from"./index-Cv84u1pM.js";const w=async()=>{try{const t=r(i,"pointages"),s=h(t,y("timestamp","desc")),o=await c(s),e=[];return o.forEach(n=>{e.push({id:n.id,...n.data()})}),e}catch(t){throw console.error("Erreur lors de la récupération des pointages:",t),t}},f=async()=>{try{const t=r(i,"agents"),s=await c(t),o=[];return s.forEach(e=>{o.push({id:e.id,...e.data()})}),o}catch(t){throw console.error("Erreur lors de la récupération des agents:",t),t}},b=(t,s)=>{const o=t.find(e=>e.ip===s);return o?o.nom:s},A=(t,s)=>{const o=[];return o.push(["Date","Heure","Type","Agent","IP","Adresse","Coordonnées GPS"].join(",")),t.forEach(e=>{const n=new Date(e.timestamp),d=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}).format(n),l=new Intl.DateTimeFormat("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(n),p=b(s,e.ip),g=e.type==="entree"?"Entrée":"Sortie",u=e.latitude&&e.longitude?`${e.latitude.toFixed(6)}, ${e.longitude.toFixed(6)}`:"Non disponible",a=m=>`"${m.replace(/"/g,'""')}"`;o.push([d,l,g,a(p),e.ip,a(e.address),u].join(","))}),o.join(`
`)},S=(t,s)=>{const o=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=URL.createObjectURL(o),n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",s),document.body.appendChild(n),n.click(),document.body.removeChild(n)},E=async()=>{try{const[t,s]=await Promise.all([w(),f()]),o=A(t,s),n=new Date().toISOString().split("T")[0];S(o,`pointages_${n}.csv`)}catch(t){throw console.error("Erreur lors de l'export des pointages:",t),t}};export{S as downloadCSV,E as exportAndDownloadPointages,A as exportToCSV,b as getAgentNameByIp,f as getAllAgents,w as getAllPointages};
